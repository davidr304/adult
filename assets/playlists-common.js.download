var playlistsUtils=(()=>{function s(e){var t=document.querySelector(".errorMessage");t&&MG_Utils.hasClass(t,"displayNone")&&void 0!==e&&(t.innerText=e,MG_Utils.removeClass(t,"displayNone"),setTimeout(function(){MG_Utils.addClass(t,"displayNone")},5e3))}function d(e,t){var a,l,s,i=document.createElement("div"),o=document.getElementById("playlist-form"),r=document.querySelector("#modalWrapMTubes .playlist-modal");o&&MG_Utils.addClass(o,"displayNone"),i.className="succesMsg",r&&(o=r.querySelector(".modal-title"),a=r.querySelector(".succesMsg"),l="",s=e.code==WIDGET_PLAYLIST_HEADER.videoNotActiveCode?WIDGET_PLAYLIST_HEADER.videoNotAdded:e.message??"",o&&(o.innerHTML=s),e.success?(o&&(o.innerHTML=WIDGET_PLAYLIST_HEADER.successNewPlaylist+"!",MG_Utils.addClass(o,"successGreen")),l=WIDGET_PLAYLIST_HEADER.successVideoAdded+": "+t):(o&&MG_Utils.addClass(o,"failureRed"),e.code!=WIDGET_PLAYLIST_HEADER.videoNotActiveCode&&(l=t+" "+(e.message??""))),a?MG_Utils.setText(a,l):(MG_Utils.setText(i,l),r.appendChild(i)),setTimeout(function(){location.reload()},3e3))}return{copyPlaylist:function(s,e,t,a,i,o,r){oldPlaylistCreateUrl&&MG_Utils.ajaxCall({type:"POST",url:oldPlaylistCreateUrl,dataType:"json",data:{title:s,tags:e,description:t,status:a,token:i},success:function(e){var t,a,l;e.success&&o?(a={},e.id&&(a.pid=e.id),r&&(a.vid=r),i&&(a.token=i),t=o,l=s,(a=a)&&MG_Utils.ajaxCall({type:"POST",url:t,data:a,dataType:"json",success:function(e){d(e,l)}})):e&&d(e,s)}})},createPlaylist:function(t,e,a,l,s,i,o){playlistCreateUrl&&MG_Utils.ajaxCall({type:"POST",url:playlistCreateUrl,requestType:"application/json",data:{title:t,tags:e.split("|"),description:a,status:l,token:token,vid:Number(s)},success:function(e){e.success=!0,d(e,t),o&&o.removeAttribute("disabled")},error:function(e){let t="";e&&(e.forEach(function(e){t=e.field+`: ${e.message} <br>`}),i&&t&&(i.innerHTML=t,MG_Utils.removeClass(i,"displayNone")),o&&o.removeAttribute("disabled"),o)&&MG_Utils.removeClass(o,"hasSubmitted")}})},addVideoToPlaylist:function(e,t,a,i,o,l){var s="watchlater"===o?playlistWatchlaterAddUrl:"lovers"===o?playlistLoversAddUrl:playlistCustomAddUrl,r={};e&&(r.pid=e),t&&(r.vid=t),a&&(r.token=a),s&&MG_Utils.ajaxCall({url:s,type:"POST",dataType:"json",data:r,success:function(e){var t=i&&i.parentNode,a=i&&i.querySelector("span");l?"function"==typeof l&&l(e):i&&(t&&MG_Utils.addClass(t,"added"),"watchlater"===o?(e=document.createElement("span"),t&&t.appendChild(e),e&&(e.textContent=TRANSLATED_MESSAGE.added)):a&&(a.textContent=TRANSLATED_MESSAGE.added))},error:function(e){var t,a,l=i&&i.parentNode,s=i&&i.querySelector("span");"Already added!"===e.message?(l&&MG_Utils.addClass(l,"alreadyAdded"),"watchlater"===o?l.querySelector("span")||(t=document.createElement("span"),l&&l.appendChild(t),t&&(t.textContent=TRANSLATED_MESSAGE.alreadyAdded+"!")):"lovers"===o?((a=(a=document.querySelector("a.lover-playlist-add"))&&a.parentNode)&&MG_Utils.addClass(a,"alreadyAdded"),t=document.createElement("span"),a&&a.appendChild(t),t&&(t.textContent=TRANSLATED_MESSAGE.alreadyAdded+"!")):s&&(s.textContent=TRANSLATED_MESSAGE.alreadyAdded+"!")):e.message&&(a=l&&l.querySelector(".alreadyInPlaylistMessage"))&&(a.innerText=e.message,MG_Utils.addClass(a,"requestErrorMessage"))}})},addToFavourites:function(e,t,a){playlistFavouriteAddUrl&&MG_Utils.ajaxCall({type:"POST",url:playlistFavouriteAddUrl,requestType:"application/json",data:{pid:Number(e),token:t},success:function(e){a&&(MG_Utils.addClass(a,"favorited"),a.setAttribute("data-title",WIDGET_PLAYLIST_HEADER.alreadyInFavorite))},error:function(e){s(e.message)}})},removeFromFavourites:function(e,t,a,l){playlistFavouriteRemoveUrl&&MG_Utils.ajaxCall({type:"DELETE",url:playlistFavouriteRemoveUrl,success:function(e){var t;a&&(MG_Utils.removeClass(a,"favorited"),a.setAttribute("data-title",WIDGET_PLAYLIST_HEADER.favoritePL)),l&&(t=document.getElementById(l))&&t.parentNode.removeChild(t)},error:function(e){s(e.message)}})},updatePlaylist:function(e,t){var a=!(!e||!e.id)&&e.id,a=a&&"watchlater"==a&&playlistUpdateUrlWatchlater?playlistUpdateUrlWatchlater:playlistUpdateUrl;a&&MG_Utils.ajaxCall({type:"POST",url:a,dataType:"json",data:e,success:function(e){t&&t(e)}})},deleteAllFromPlaylist:function(e,t,a,l){removeAllVideosFromPlaylist&&MG_Utils.ajaxCall({type:"POST",url:a||removeAllVideosFromPlaylist,dataType:"json",data:{pid:e,token:t},success:function(e){l()}})},deletePlaylist:function(){playlistDeleteUrl&&MG_Utils.ajaxCall({type:"DELETE",url:playlistDeleteUrl,success:function(e){window.location.href=myPlaylistUrl}})},removeVideoFromPlaylist:function(e,t,a){MG_Utils.ajaxCall({type:"DELETE",url:playlistActionBaseUrl+e+"/video_remove/"+t+"?token="+a})},removeVideoFromWatchlater:function(e,t){MG_Utils.ajaxCall({type:"DELETE",url:playlistActionBaseUrl+"video_remove_watchlater?token="+t+"&vid="+e})},removeVideoFromLovers:function(e,t){MG_Utils.ajaxCall({type:"DELETE",url:playlistActionBaseUrl+"lovers/video_remove/"+e+"?token="+t})},playlistRate:function(e,t){var a;playlistRateUrl&&(a={token:token,pid:Number(e.pid),value:Boolean(e.value)},e.current&&(a.current=e.current),MG_Utils.ajaxCall({type:"POST",url:playlistRateUrl,requestType:"application/json",data:a,success:function(e){e&&void 0!==t&&t&&(e={id:e.id,value:Number(e.value)},LocalStorageManager.getInstance().push("playlistRated",e))}}))},loadVideos:function(e,t,a,l,s){e&&MG_Utils.ajaxGetData({url:e+"&offset="+(l+t*a)+"&itemsPerPage="+a,method:"get",success:function(e){s&&s(e)}})},lazyLoadVideos:function(e,t,a){e&&MG_Utils.ajaxGetData({url:e+"&page="+t,method:"GET",success:function(e){a&&a(e),(new LazyLoadImage).init(page_params.lazyLoad)}})},savePlaylist:function(e,t,a){e&&MG_Utils.ajaxCall({url:e,data:t,type:"POST",success:function(e){a&&a(e)}})}}})();